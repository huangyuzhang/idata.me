<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Subqueries | iData.me</title>
    <meta name="description" content="For those who wants to be a data scientist.">
    <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
    
    <link rel="preload" href="/assets/css/styles.f75737ac.css" as="style"><link rel="preload" href="/assets/js/app.f75737ac.js" as="script"><link rel="preload" href="/assets/js/62.ed14bb9b.js" as="script"><link rel="prefetch" href="/assets/js/29.2589cde2.js"><link rel="prefetch" href="/assets/css/1.styles.69637b22.css"><link rel="prefetch" href="/assets/js/1.69637b22.js"><link rel="prefetch" href="/assets/css/2.styles.17035a29.css"><link rel="prefetch" href="/assets/js/2.17035a29.js"><link rel="prefetch" href="/assets/js/3.e12f39d3.js"><link rel="prefetch" href="/assets/js/4.9f1f0077.js"><link rel="prefetch" href="/assets/js/5.5b145ab8.js"><link rel="prefetch" href="/assets/js/6.e7ce3b60.js"><link rel="prefetch" href="/assets/js/7.b502418f.js"><link rel="prefetch" href="/assets/js/8.06d48bdb.js"><link rel="prefetch" href="/assets/js/9.48931708.js"><link rel="prefetch" href="/assets/js/10.c856a2d4.js"><link rel="prefetch" href="/assets/js/11.c8c7f33d.js"><link rel="prefetch" href="/assets/js/12.a1000fe1.js"><link rel="prefetch" href="/assets/js/13.7bd61a4a.js"><link rel="prefetch" href="/assets/js/14.beb5547d.js"><link rel="prefetch" href="/assets/js/15.c7814c8a.js"><link rel="prefetch" href="/assets/js/16.f9346715.js"><link rel="prefetch" href="/assets/js/17.867db27f.js"><link rel="prefetch" href="/assets/js/18.be662003.js"><link rel="prefetch" href="/assets/js/19.c0628e65.js"><link rel="prefetch" href="/assets/js/20.55ac23bd.js"><link rel="prefetch" href="/assets/js/21.707180d7.js"><link rel="prefetch" href="/assets/js/22.ab89960f.js"><link rel="prefetch" href="/assets/js/23.84112595.js"><link rel="prefetch" href="/assets/js/24.ad668e78.js"><link rel="prefetch" href="/assets/js/25.fdf10ba6.js"><link rel="prefetch" href="/assets/js/26.c57e4569.js"><link rel="prefetch" href="/assets/js/27.9e01bcaf.js"><link rel="prefetch" href="/assets/js/28.c539a631.js"><link rel="prefetch" href="/assets/js/30.e1f08678.js"><link rel="prefetch" href="/assets/js/31.b14ac7ac.js"><link rel="prefetch" href="/assets/js/32.ddc03c03.js"><link rel="prefetch" href="/assets/js/33.29d59cb2.js"><link rel="prefetch" href="/assets/js/34.ce647662.js"><link rel="prefetch" href="/assets/js/35.8e7bac8d.js"><link rel="prefetch" href="/assets/js/36.187f792a.js"><link rel="prefetch" href="/assets/js/37.070abf55.js"><link rel="prefetch" href="/assets/js/38.5e1c3dc2.js"><link rel="prefetch" href="/assets/js/39.78bbe7bc.js"><link rel="prefetch" href="/assets/js/40.2b3c6eac.js"><link rel="prefetch" href="/assets/js/41.482d3da6.js"><link rel="prefetch" href="/assets/js/42.622c220e.js"><link rel="prefetch" href="/assets/js/43.f1465c3e.js"><link rel="prefetch" href="/assets/js/44.8ce5c4d4.js"><link rel="prefetch" href="/assets/js/45.b4cbae77.js"><link rel="prefetch" href="/assets/js/46.e23bea99.js"><link rel="prefetch" href="/assets/js/47.33bd4fd8.js"><link rel="prefetch" href="/assets/js/48.c4905483.js"><link rel="prefetch" href="/assets/js/49.10b80667.js"><link rel="prefetch" href="/assets/js/50.3e893ee8.js"><link rel="prefetch" href="/assets/js/51.0f2fea64.js"><link rel="prefetch" href="/assets/js/52.7754bb9a.js"><link rel="prefetch" href="/assets/js/53.3edf3f08.js"><link rel="prefetch" href="/assets/js/54.88094403.js"><link rel="prefetch" href="/assets/js/55.debba124.js"><link rel="prefetch" href="/assets/js/56.54008921.js"><link rel="prefetch" href="/assets/js/57.9f35013e.js"><link rel="prefetch" href="/assets/js/58.65ee4cb9.js"><link rel="prefetch" href="/assets/js/59.c4072634.js"><link rel="prefetch" href="/assets/js/60.b0c93af2.js"><link rel="prefetch" href="/assets/js/61.7157d217.js">
    <link rel="stylesheet" href="/assets/css/1.styles.69637b22.css"><link rel="stylesheet" href="/assets/css/2.styles.17035a29.css"><link rel="stylesheet" href="/assets/css/styles.f75737ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">iData.me</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Business Analytics</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ba/data-analytics/" class="nav-link">Data Analytics</a></li><li class="dropdown-item"><!----> <a href="/ba/strategic-analysis/" class="nav-link">Strategic Analysis</a></li><li class="dropdown-item"><!----> <a href="/ba/programming-for-business-analytics/" class="nav-link">Programming for B.A.</a></li><li class="dropdown-item"><!----> <a href="/ba/masterclass/" class="nav-link">Masterclass in B.A.</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Programming</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link router-link-active">SQL</a></li><li class="dropdown-item"><!----> <a href="/r/" class="nav-link">R</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/" class="nav-link">Other Notes</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">About</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Business Analytics</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ba/data-analytics/" class="nav-link">Data Analytics</a></li><li class="dropdown-item"><!----> <a href="/ba/strategic-analysis/" class="nav-link">Strategic Analysis</a></li><li class="dropdown-item"><!----> <a href="/ba/programming-for-business-analytics/" class="nav-link">Programming for B.A.</a></li><li class="dropdown-item"><!----> <a href="/ba/masterclass/" class="nav-link">Masterclass in B.A.</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Programming</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link router-link-active">SQL</a></li><li class="dropdown-item"><!----> <a href="/r/" class="nav-link">R</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/" class="nav-link">Other Notes</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">About</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>SQL Basics</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/sql/" class="sidebar-link">SQL Manipulation</a></li><li><a href="/sql/queries.html" class="sidebar-link">SQL Queries</a></li><li><a href="/sql/aggregate-functions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/sql/multiple-tables.html" class="sidebar-link">Multiple Tables</a></li><li><a href="/sql/exercises.html" class="sidebar-link">SQL Exercises</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>SQL: Table Transformation</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/sql/table-transformation/" class="sidebar-link">Introduction</a></li><li><a href="/sql/table-transformation/subqueries.html" class="active sidebar-link">Subqueries</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sql/table-transformation/subqueries.html#non-correlated-subqueries-i" class="sidebar-link">Non-Correlated Subqueries I</a></li><li class="sidebar-sub-header"><a href="/sql/table-transformation/subqueries.html#non-correlated-subqueries-ii" class="sidebar-link">Non-Correlated Subqueries II</a></li><li class="sidebar-sub-header"><a href="/sql/table-transformation/subqueries.html#non-correlated-subqueries-iii" class="sidebar-link">Non-Correlated Subqueries III</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="subqueries"><a href="#subqueries" aria-hidden="true" class="header-anchor">#</a> Subqueries</h1> <p>As said before, we'll begin learning about table transformation through subqueries. <strong>Subqueries</strong>, sometimes referred to as inner queries or nested queries, are used to transform table data by nesting one query within another query.</p> <div class="tip custom-block"><p class="custom-block-title">Warm-up Exercise</p> <p>We'll be working with an airport database. Let's begin by looking at the data tables.</p> <p>Select ten rows from the <code>flights</code> table.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> flights
<span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <h2 id="non-correlated-subqueries-i"><a href="#non-correlated-subqueries-i" aria-hidden="true" class="header-anchor">#</a> Non-Correlated Subqueries I</h2> <p>Let's continue with subqueries.</p> <p>Imagine that you are the head of air traffic control. In our airplanes database, you'd like to know which flights had an origin airport with an elevation greater than 2000 feet. We can do this with a subquery.</p> <p>We first create an inner query, or subquery, that finds the airports with elevation greater than 2000 from the airports table:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> code
  <span class="token keyword">FROM</span> airports
  <span class="token keyword">WHERE</span> elevation <span class="token operator">&gt;</span> <span class="token number">2000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Next, we take the result set of the inner query and use it to filter on the flights table, to find the flight detail that meets the elevation criteria.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> flights
<span class="token keyword">WHERE</span> origin <span class="token operator">in</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> code
    <span class="token keyword">FROM</span> airports
    <span class="token keyword">WHERE</span> elevation <span class="token operator">&gt;</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>As shown above, a subquery is nested within another query to give us our desired result.</p> <div class="tip custom-block"><p class="custom-block-title">Mini Exercise</p> <p>Using the same pattern from the example above, find flight information about flights where the origin elevation is less than 2000 feet.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> flights
<span class="token keyword">WHERE</span> origin <span class="token operator">in</span><span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> code
  <span class="token keyword">FROM</span> airports
  <span class="token keyword">WHERE</span> elevation <span class="token operator">&lt;</span> <span class="token number">2000</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <h2 id="non-correlated-subqueries-ii"><a href="#non-correlated-subqueries-ii" aria-hidden="true" class="header-anchor">#</a> Non-Correlated Subqueries II</h2> <p>Great! The query we just ran is just one kind of subquery, what we refer to as a non-correlated subquery. A <strong>non-correlated subquery（非关联子查询）</strong> is a subquery that can be run independently of the outer query and as we saw, can be used to complete a multi-step transformation.</p> <p>Let's try one more non-correlated subquery. Perhaps we'd like to look at a selection of flights whose origin airport is a seaplane base, designated by <code>SEAPLANE_BASE</code>. The facility type of an airport is located in the <code>fac_type</code> field of the airports table.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> flights
<span class="token keyword">WHERE</span> origin <span class="token operator">in</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> code
    <span class="token keyword">FROM</span> airports
    <span class="token keyword">WHERE</span> fac_type <span class="token operator">=</span> <span class="token string">'SEAPLANE_BASE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Mini Exercise</p> <p>Using the same pattern, find flight information about flights where the Federal Aviation Administration region (<code>faa_region</code>) is the Southern region (<code>ASO</code>).</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> flights
<span class="token keyword">WHERE</span> origin <span class="token operator">in</span><span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> code
  <span class="token keyword">FROM</span> airports
  <span class="token keyword">WHERE</span> faa_region <span class="token operator">=</span> <span class="token string">'ASO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <h2 id="non-correlated-subqueries-iii"><a href="#non-correlated-subqueries-iii" aria-hidden="true" class="header-anchor">#</a> Non-Correlated Subqueries III</h2> <p>The non-correlated subquery examples we've used so far utilized two tables (flights and airports), but we can also perform transformations on a single table. For instance, sometimes we need to aggregate in multiple steps - like taking an average of a count.</p> <p>Imagine you’d like to know how many flights there are on average, for all Fridays in a given month from the flights table. First, we’d need to calculate the number of flights per day, and then we’d need to calculate the average based on the daily flight count for each day of the week. We can do this all in one step using a subquery:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>dep_month<span class="token punctuation">,</span>
       a<span class="token punctuation">.</span>dep_day_of_week<span class="token punctuation">,</span>
       <span class="token function">AVG</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>flight_count<span class="token punctuation">)</span> <span class="token keyword">AS</span> average_flights
  <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
        <span class="token keyword">SELECT</span> dep_month<span class="token punctuation">,</span>
              dep_day_of_week<span class="token punctuation">,</span>
               dep_date<span class="token punctuation">,</span>
               <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> flight_count
          <span class="token keyword">FROM</span> flights
         <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span>
       <span class="token punctuation">)</span> a
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>
  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>The inner query provides the count of flights by day, and the outer query uses the inner query’s result set to compute the average by day of week of a given month.</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/9/2018, 7:31:15 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/sql/table-transformation/" class="prev router-link-active">
          Introduction
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/assets/js/62.ed14bb9b.js" defer></script><script src="/assets/js/app.f75737ac.js" defer></script>
  </body>
</html>
