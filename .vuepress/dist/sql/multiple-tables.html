<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Multiple Tables | Yuzhang&#39;s Notes</title>
    <meta name="description" content="Yuzhang Huang&#39;s personal online notebook">
    
    
    <link rel="preload" href="/assets/css/styles.157cf73c.css" as="style"><link rel="preload" href="/assets/js/app.157cf73c.js" as="script"><link rel="preload" href="/assets/js/51.438d99df.js" as="script"><link rel="prefetch" href="/assets/js/25.82018898.js"><link rel="prefetch" href="/assets/css/1.styles.6069594e.css"><link rel="prefetch" href="/assets/js/1.6069594e.js"><link rel="prefetch" href="/assets/css/2.styles.19d85097.css"><link rel="prefetch" href="/assets/js/2.19d85097.js"><link rel="prefetch" href="/assets/js/3.c1ffa00e.js"><link rel="prefetch" href="/assets/js/4.7cb17ac0.js"><link rel="prefetch" href="/assets/js/5.5b145ab8.js"><link rel="prefetch" href="/assets/js/6.e7ce3b60.js"><link rel="prefetch" href="/assets/js/7.b502418f.js"><link rel="prefetch" href="/assets/js/8.06d48bdb.js"><link rel="prefetch" href="/assets/js/9.48931708.js"><link rel="prefetch" href="/assets/js/10.c856a2d4.js"><link rel="prefetch" href="/assets/js/11.c8c7f33d.js"><link rel="prefetch" href="/assets/js/12.5cfb0c2f.js"><link rel="prefetch" href="/assets/js/13.80ce9d84.js"><link rel="prefetch" href="/assets/js/14.8891ef64.js"><link rel="prefetch" href="/assets/js/15.ef767567.js"><link rel="prefetch" href="/assets/js/16.720d2db3.js"><link rel="prefetch" href="/assets/js/17.9c64902d.js"><link rel="prefetch" href="/assets/js/18.7da0c779.js"><link rel="prefetch" href="/assets/js/19.5977bc4c.js"><link rel="prefetch" href="/assets/js/20.87b8ee4f.js"><link rel="prefetch" href="/assets/js/21.9ef12f9c.js"><link rel="prefetch" href="/assets/js/22.d234b9e1.js"><link rel="prefetch" href="/assets/js/23.32ad95d0.js"><link rel="prefetch" href="/assets/js/24.b13914ca.js"><link rel="prefetch" href="/assets/js/26.8737b6f8.js"><link rel="prefetch" href="/assets/js/27.43127ef4.js"><link rel="prefetch" href="/assets/js/28.4bd3ac93.js"><link rel="prefetch" href="/assets/js/29.b5f172e8.js"><link rel="prefetch" href="/assets/js/30.ddc2f87d.js"><link rel="prefetch" href="/assets/js/31.b1957c3a.js"><link rel="prefetch" href="/assets/js/32.081b9527.js"><link rel="prefetch" href="/assets/js/33.057c1bc2.js"><link rel="prefetch" href="/assets/js/34.6d9f67f6.js"><link rel="prefetch" href="/assets/js/35.a794ebf3.js"><link rel="prefetch" href="/assets/js/36.e20daf3a.js"><link rel="prefetch" href="/assets/js/37.4d3171bc.js"><link rel="prefetch" href="/assets/js/38.73716476.js"><link rel="prefetch" href="/assets/js/39.fbc57a2b.js"><link rel="prefetch" href="/assets/js/40.4ade963a.js"><link rel="prefetch" href="/assets/js/41.bacc9344.js"><link rel="prefetch" href="/assets/js/42.3865e38b.js"><link rel="prefetch" href="/assets/js/43.9349e8b8.js"><link rel="prefetch" href="/assets/js/44.e498e7bb.js"><link rel="prefetch" href="/assets/js/45.4209ebf3.js"><link rel="prefetch" href="/assets/js/46.0e1b159a.js"><link rel="prefetch" href="/assets/js/47.b6847adc.js"><link rel="prefetch" href="/assets/js/48.10017ea9.js"><link rel="prefetch" href="/assets/js/49.c3e77c4d.js"><link rel="prefetch" href="/assets/js/50.2adf1245.js"><link rel="prefetch" href="/assets/js/52.18d4dc84.js"><link rel="prefetch" href="/assets/js/53.341ca6ca.js"><link rel="prefetch" href="/assets/js/54.159d4770.js">
    <link rel="stylesheet" href="/assets/css/1.styles.6069594e.css"><link rel="stylesheet" href="/assets/css/2.styles.19d85097.css"><link rel="stylesheet" href="/assets/css/styles.157cf73c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Yuzhang's Notes</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/ba/" class="nav-link">BA</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Programming</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link router-link-active">SQL</a></li><li class="dropdown-item"><!----> <a href="/r/" class="nav-link">R</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/" class="nav-link">Other Notes</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">About me</a></li></ul></li><li class="dropdown-item"><h4>External</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.51redaiyu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  热带鱼
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://www.iyu.co" target="_blank" rel="noopener noreferrer" class="nav-link external">
  爱鱼客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://git.iyu.co" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My Git
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/ba/" class="nav-link">BA</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Programming</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link router-link-active">SQL</a></li><li class="dropdown-item"><!----> <a href="/r/" class="nav-link">R</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/" class="nav-link">Other Notes</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">About me</a></li></ul></li><li class="dropdown-item"><h4>External</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.51redaiyu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  热带鱼
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://www.iyu.co" target="_blank" rel="noopener noreferrer" class="nav-link external">
  爱鱼客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://git.iyu.co" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My Git
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>SQL Basics</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/sql/" class="sidebar-link">SQL Manipulation</a></li><li><a href="/sql/queries.html" class="sidebar-link">SQL Queries</a></li><li><a href="/sql/aggregate-functions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/sql/multiple-tables.html" class="active sidebar-link">Multiple Tables</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#combining-tables-manually" class="sidebar-link">Combining Tables Manually</a></li><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#combining-tables-with-sql" class="sidebar-link">Combining Tables with SQL</a></li><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#inner-joins" class="sidebar-link">Inner Joins</a></li><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#left-joins" class="sidebar-link">Left Joins</a></li><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#primary-key-vs-foreign-key" class="sidebar-link">Primary Key vs Foreign Key</a></li><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#cross-join" class="sidebar-link">Cross Join</a></li><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#union" class="sidebar-link">Union</a></li><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#△-with" class="sidebar-link">△ With</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#database-schema" class="sidebar-link">Database Schema</a></li></ul></li><li class="sidebar-sub-header"><a href="/sql/multiple-tables.html#review" class="sidebar-link">Review</a></li></ul></li><li><a href="/sql/exercises.html" class="sidebar-link">SQL Exercises</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>SQL: Table Transformation</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/sql/table-transformation/" class="sidebar-link">Introduction</a></li><li><a href="/sql/table-transformation/subqueries.html" class="sidebar-link">Subqueries</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="multiple-tables"><a href="#multiple-tables" aria-hidden="true" class="header-anchor">#</a> Multiple Tables</h1> <h2 id="introduction"><a href="#introduction" aria-hidden="true" class="header-anchor">#</a> Introduction</h2> <p>In order to efficiently store data, we often spread related information across multiple tables.</p> <p>For instance, imagine that we're running a magazine company where users can have different types of subscriptions to different products. Different subscriptions might have many different properties. Each customer would also have lots of associated information.</p> <p>We could have one table with all of the following information:</p> <ul><li><code>order_id</code></li> <li><code>customer_id</code></li> <li><code>customer_name</code></li> <li><code>customer_address</code></li> <li><code>subscription_id</code></li> <li><code>subscription_description</code></li> <li><code>subscription_monthly_price</code></li> <li><code>subscription_length</code></li> <li><code>purchase_date</code></li></ul> <p>However, a lot of this information would be repeated. If the same customer has multiple subscriptions, that customer's name and address will be reported multiple times. If the same subscription type is ordered by multiple customers, then the subscription price and subscription description will be repeated. This will make our table big and unmanageable.</p> <p>So instead, we can split our data into three tables:</p> <ul><li><p><code>orders</code> would contain just the information necessary to describe what was ordered:</p> <ul><li><code>order_id</code></li> <li><code>customer_id</code></li> <li><code>subscription_id</code></li> <li><code>purchase_date</code></li></ul></li> <li><p><code>subscriptions</code> would contain the information to describe each type of subscription:</p> <ul><li><code>subscription_id</code></li> <li><code>description</code></li> <li><code>price_per_month</code></li> <li><code>subscription_length</code></li></ul></li> <li><p><code>customers</code> would contain the information for each customer:</p> <ul><li><code>customer_id</code></li> <li><code>customer_name</code></li> <li><code>address</code></li></ul></li></ul> <p>In this lesson, we'll learn the SQL commands that will help us work with data that is stored in multiple tables.</p> <h2 id="combining-tables-manually"><a href="#combining-tables-manually" aria-hidden="true" class="header-anchor">#</a> Combining Tables Manually</h2> <p>Let's return to our magazine company. Suppose we have the three tables described in the previous exercise – shown in the browser on the right (we are going to try something new!):</p> <ul><li><code>orders</code></li> <li><code>subscriptions</code></li> <li><code>customers</code></li></ul> <p>If we just look at the <code>orders</code> table, we can't really tell what's happened in each order. However, if we refer to the other tables, we can get a complete picture.</p> <p>Let's examine the order with an <code>order_id</code> of 2. It was purchased by the customer with a <code>customer_id</code> of 2.</p> <p>To find out the customer's name, we look at the <code>customers</code> table and look for the item with a <code>customer_id</code> value of 2. We can see that Customer 2's name is 'Jane Doe' and that she lives at '456 Park Ave'.</p> <p>Doing this kind of matching is called <strong>joining</strong> two tables.</p> <h2 id="combining-tables-with-sql"><a href="#combining-tables-with-sql" aria-hidden="true" class="header-anchor">#</a> Combining Tables with SQL</h2> <p>Combining tables manually is time-consuming. Luckily, SQL gives us an easy sequence for this: it's called a <code>JOIN</code>.</p> <p>If we want to combine <code>orders</code> and <code>customers</code>, we would type:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> orders
<span class="token keyword">JOIN</span> customers
  <span class="token keyword">ON</span> orders<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>customer_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Let's break down this command:</p> <ol><li>The first line selects all columns from our combined table. If we only want to select certain columns, we can specify which ones we want.</li> <li>The second line specifies the first table that we want to look in, <code>orders</code></li> <li>The third line uses <code>JOIN</code> to say that we want to combine information from <code>orders</code> with <code>customers</code>.</li> <li>The fourth line tells us how to combine the two tables. We want to match <code>orders</code> table's <code>customer_id</code> column with <code>customers</code> table's <code>customer_id</code> column.</li></ol></div> <p>Because column names are often repeated across multiple tables, we use the syntax <code>table_name.column_name</code> to be sure that our requests for columns are unambiguous. In our example, we use this syntax in the <code>ON</code> statement, but we will also use it in the <code>SELECT</code> or any other statement where we refer to column names.</p> <p>For example: Instead of selecting <em>all</em> the columns using <code>*</code>, if we only wanted to select <code>orders</code> table's <code>order_id</code> column and <code>customers</code> table's <code>customer_name</code> column, we could use the following query:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> orders<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>
   customers<span class="token punctuation">.</span>customer_name
<span class="token keyword">FROM</span> orders
<span class="token keyword">JOIN</span> customers
  <span class="token keyword">ON</span> orders<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>customer_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Mini Exercise</p> <p>Join orders table and subscriptions table and select all columns.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> orders
<span class="token keyword">JOIN</span> subscriptions
	<span class="token keyword">ON</span> orders<span class="token punctuation">.</span>subscription_id <span class="token operator">=</span> subscriptions<span class="token punctuation">.</span>subscription_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Add a second query after your first one that only selects rows from the join where <code>description</code> is equal to 'Fashion Magazine'.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> orders
<span class="token keyword">JOIN</span> subscriptions
	<span class="token keyword">ON</span> orders<span class="token punctuation">.</span>subscription_id <span class="token operator">=</span> subscriptions<span class="token punctuation">.</span>subscription_id
<span class="token keyword">WHERE</span> subscriptions<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token string">'Fashion Magazine'</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <h2 id="inner-joins"><a href="#inner-joins" aria-hidden="true" class="header-anchor">#</a> Inner Joins</h2> <p>Let's revisit how we joined <code>orders</code> and <code>customers</code>. For every possible value of <code>customer_id</code> in <code>orders</code>, there was a corresponding row of <code>customers</code> with the same <code>customer_id</code>.</p> <p>What if that wasn't true?</p> <p>For instance, imagine that our <code>customers</code> table was out of date, and was missing any information on customer 11. If that customer had an order in <code>orders</code>, what would happen when we joined the tables?</p> <p>When we perform a simple <code>JOIN</code> (often called an inner join) our result only includes rows that match our <code>ON</code> condition.</p> <p>Consider the following animation, which illustrates an inner join of two tables on <code>table1.c2 = table2.c2</code>:</p> <p><img src="/img/201808/inner-join.gif" alt="Animation of an Inner Join" title="Animation of an Inner Join"></p> <p>The first and last rows have matching values of <code>c2</code>. The middle rows do not match. The final result has all values from the first and last rows but does not include the non-matching middle row.</p> <div class="tip custom-block"><p class="custom-block-title">Mini Exercise</p> <p>Suppose we are working for The Codecademy Times, a newspaper with two types of subscriptions:</p> <ul><li>print newspaper</li> <li>online articles</li></ul> <p>Some users subscribe to just the newspaper, some subscribe to just the online edition, and some subscribe to both.</p> <p>There is a <code>newspaper</code> table that contains information about the newspaper subscribers.</p> <p>Count the number of subscribers who get a print newspaper using <code>COUNT()</code>.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> newspaper<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>There is also an <code>online</code> table that contains information about the online subscribers.</p> <p>Count the number of subscribers who get an online newspaper using <code>COUNT()</code>.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> online<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Join <code>newspaper</code> table and <code>online</code> table on their <code>id</code> columns (the unique ID of the subscriber).</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> newspaper
<span class="token keyword">JOIN</span> online
	<span class="token keyword">ON</span> newspaper<span class="token punctuation">.</span>id <span class="token operator">=</span> online<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <h2 id="left-joins"><a href="#left-joins" aria-hidden="true" class="header-anchor">#</a> Left Joins</h2> <p>What if we want to combine two tables and keep some of the un-matched rows?</p> <p>SQL lets us do this through a command called <code>LEFT JOIN</code>. A left join will keep all rows from the first table, regardless of whether there is a matching row in the second table.</p> <p>Consider the following animation:</p> <p><img src="/img/201808/left-join.gif" alt="Animation of a Left Join" title="Animation of a Left Join"></p> <p>The first and last rows have matching values of <code>c2</code>. The middle rows do not match. The final result will keep all rows of the first table but will omit the un-matched row from the second table.</p> <p>This animation represents a table operation produced by the following command:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> table1
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> table2
  <span class="token keyword">ON</span> table1<span class="token punctuation">.</span>c2 <span class="token operator">=</span> table2<span class="token punctuation">.</span>c2<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <ol><li>The first line selects all columns from both tables.</li> <li>The second line selects <code>table1</code> (the &quot;left&quot; table).</li> <li>The third line performs a <code>LEFT JOIN</code> on <code>table2</code> (the &quot;right&quot; table).</li> <li>The fourth line tells SQL how to perform the join (by looking for matching values in column <code>c2</code>.</li></ol></div> <div class="tip custom-block"><p class="custom-block-title">Mini Exercise</p> <p>Let's return to our <code>newspaper</code> and <code>online</code> subscribers.</p> <p>Suppose we want to know how many users subscribe to the print newspaper, but not to the online.</p> <p>Start by performing a left join of <code>newspaper</code> table and <code>online</code> table on their <code>id</code> columns and selecting all columns.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> newspaper
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> online
  <span class="token keyword">ON</span> newspaper<span class="token punctuation">.</span>id <span class="token operator">=</span> online<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Don't remove your previous query.</p> <p>In order to find which users do not subscribe to the online edition, we need to add a <code>WHERE</code> clause.</p> <p>Add a second query after your first one that adds the following <code>WHERE</code> clause and condition:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">WHERE</span> online<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token boolean">NULL</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This will select rows where there was no corresponding row from the <code>online</code> table.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> newspaper
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> online
  <span class="token keyword">ON</span> newspaper<span class="token punctuation">.</span>id <span class="token operator">=</span> online<span class="token punctuation">.</span>id
  <span class="token keyword">WHERE</span> online<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <h2 id="primary-key-vs-foreign-key"><a href="#primary-key-vs-foreign-key" aria-hidden="true" class="header-anchor">#</a> Primary Key vs Foreign Key</h2> <p>Let's return to our example of the magazine subscriptions. Recall that we had three tables: <code>orders</code>, <code>subscriptions</code>, and <code>customers</code>.</p> <p>Each of these tables has a column that uniquely identifies each row of that table:</p> <ul><li><code>order_id</code> for <code>orders</code></li> <li><code>subscription_id</code> for <code>subscriptions</code></li> <li><code>customer_id</code> for <code>customers</code></li></ul> <p>These special columns are called <strong>primary keys</strong>.</p> <p>Primary keys have a few requirements:</p> <ul><li>None of the values can be <code>NULL</code>.</li> <li>Each value must be unique (i.e., you can't have two customers with the same <code>customer_id</code> in the <code>customers</code> table).</li> <li>A table can not have more than one primary key column.
Let's reexamine the <code>orders</code> table:</li></ul> <table><thead><tr><th>order_id</th> <th>customer_id</th> <th>subscription_id</th> <th>purchase_date</th></tr></thead> <tbody><tr><td>1</td> <td>2</td> <td>3</td> <td>2017-01-01</td></tr> <tr><td>2</td> <td>2</td> <td>2</td> <td>2017-01-01</td></tr> <tr><td>3</td> <td>3</td> <td>1</td> <td>2017-01-01</td></tr></tbody></table> <p>Note that <code>customer_id</code> (the primary key for <code>customers</code>) and <code>subscription_id</code> (the primary key for <code>subscriptions</code>) both appear in this.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>When the primary key for one table appears in a different table, it is called a <strong>foreign key</strong>.</p></div> <p>So <code>customer_id</code> is a primary key when it appears in <code>customers</code>, but a foreign key when it appears in <code>orders</code>.</p> <p>In this example, our primary keys all had somewhat descriptive names. Generally, the primary key will just be called <code>id</code>. Foreign keys will have more descriptive names.</p> <p><em>Why is this important?</em> The most common types of joins will be joining a foreign key from one table with the primary key from another table. For instance, when we join <code>orders</code> and <code>customers</code>, we join on <code>customer_id</code>, which is a foreign key in <code>orders</code> and the primary key in <code>customers</code>.</p> <div class="tip custom-block"><p class="custom-block-title">Mini Exercise</p> <p>Suppose Columbia University has two tables in their database:</p> <ul><li>The <code>classes</code> table contains information on the classes that the school offers. Its primary key is <code>id</code>.</li> <li>The <code>students</code> table contains information on all students in the school. Its primary key is <code>id</code>. It contains the foreign key <code>class_id</code>, which corresponds to the primary key of <code>classes</code>.</li></ul> <p>Perform an inner join of <code>classes</code> and <code>students</code> using the primary and foreign keys described above, and select all the columns.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> classes
<span class="token keyword">JOIN</span> students
  <span class="token keyword">ON</span> classes<span class="token punctuation">.</span>id <span class="token operator">=</span> students<span class="token punctuation">.</span>class_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <h2 id="cross-join"><a href="#cross-join" aria-hidden="true" class="header-anchor">#</a> Cross Join</h2> <p>So far, we've focused on matching rows that have some information in common.</p> <p>Sometimes, we just want to combine all rows of one table with all rows of another table.</p> <p>For instance, if we had a table of <code>shirts</code> and a table of <code>pants</code>, we might want to know all the possible combinations to create different outfits.</p> <p>Our code might look like this:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> shirts<span class="token punctuation">.</span>shirt_color<span class="token punctuation">,</span> pants<span class="token punctuation">.</span>pants_color
<span class="token keyword">FROM</span> shirts
<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> pants<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li>The first line select the columns <code>shirt_color</code> and <code>pants_color</code>.</li> <li>The third line pulls data from the table <code>shirts</code>.</li> <li>The fourth line performs a <code>CROSS JOIN</code> with <code>pants</code>.</li></ul> <p><strong>*</strong> Notice that cross joins don't require an <code>ON</code> statement. You're not really joining on any columns!</p></div> <p>If we have 3 different shirts (white, grey, and olive) and 2 different pants (light denim and black), the results might look like this:</p> <table><thead><tr><th>shirt_color</th> <th>pants_color</th></tr></thead> <tbody><tr><td>white</td> <td>light denim</td></tr> <tr><td>white</td> <td>black</td></tr> <tr><td>grey</td> <td>light denim</td></tr> <tr><td>grey</td> <td>black</td></tr> <tr><td>olive</td> <td>light denim</td></tr> <tr><td>olive</td> <td>black</td></tr></tbody></table> <p>3 shirts × 2 pants = 6 combinations!</p> <p>This clothing example is fun, but it's not very practically useful.</p> <p>A more common usage of <code>CROSS JOIN</code> is when we need to compare each row of a table to a list of values.</p> <p>Let's return to our <code>newspaper</code> subscriptions. This table contains two columns that we haven't discussed yet:</p> <ul><li><code>start_month</code>: the first month where the customer subscribed to the print newspaper (i.e., <code>2</code> for February)</li> <li><code>end_month</code>: the final month where the customer subscribed to the print newspaper
Suppose we wanted to know how many users were subscribed during each month of the year. For each month (<code>1</code>, <code>2</code>, <code>3</code>) we would need to know if a user was subscribed. Follow the steps below to see how we can use a <code>CROSS JOIN</code> to solve this problem.</li></ul> <div class="tip custom-block"><p class="custom-block-title">Mini Exercise 1</p> <p>Eventually, we'll use a cross join to help us, but first, let's try a simpler problem.</p> <p>Let's start by counting the number of customers who were subscribed to the <code>newspaper</code> during March.</p> <p>Use <code>COUNT(*)</code> to count the number of rows and a <code>WHERE</code> clause to restrict to two conditions:</p> <ul><li><code>start_month &lt;= 3</code></li> <li><code>end_month &gt;= 3</code></li></ul> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> newspaper
<span class="token keyword">WHERE</span> start_month <span class="token operator">&lt;=</span> <span class="token number">3</span>
	<span class="token operator">AND</span> end_month <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <div class="tip custom-block"><p class="custom-block-title">Mini Exercise 2</p> <p>The previous query lets us investigate one month at a time. In order to check across all months, we're going to need to use a cross join.</p> <p>Our database contains another table called <code>months</code> which contains the numbers between 1 and 12.</p> <p>Select all columns from the cross join of <code>newspaper</code> and <code>months</code>.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> newspaper
<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> months<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <div class="tip custom-block"><p class="custom-block-title">Mini Exercise 3</p> <p>Create a third query where you add a <code>WHERE</code> statement to your cross join to restrict to two conditions:</p> <ul><li><code>start_month &lt;= month</code></li> <li><code>end_month &gt;= month</code></li></ul> <p>This will select all months where a user was subscribed.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> newspaper
<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> months
<span class="token keyword">WHERE</span> start_month <span class="token operator">&lt;=</span> <span class="token keyword">month</span>
  <span class="token operator">AND</span> end_month <span class="token operator">&gt;=</span> <span class="token keyword">month</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <div class="tip custom-block"><p class="custom-block-title">Mini Exercise 4</p> <p>Create a final query where you aggregate over each month to count the number of subscribers.</p> <p>Fill in the blanks in the following query:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span>
  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> ________
<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> ________
<span class="token keyword">WHERE</span> ________ <span class="token operator">AND</span> ________
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> ________<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Further, rename the column for better output.</p> <p><strong>Answer</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'subscribers'</span>
<span class="token keyword">FROM</span> newspaper
<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> months
<span class="token keyword">WHERE</span> start_month <span class="token operator">&lt;=</span> <span class="token keyword">month</span>
	<span class="token operator">AND</span> end_month <span class="token operator">&gt;=</span> <span class="token keyword">month</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Output</strong></p> <table><thead><tr><th>month</th> <th>subscribers</th></tr></thead> <tbody><tr><td>1</td> <td>2</td></tr> <tr><td>2</td> <td>9</td></tr> <tr><td>3</td> <td>13</td></tr> <tr><td>4</td> <td>17</td></tr> <tr><td>5</td> <td>27</td></tr> <tr><td>6</td> <td>30</td></tr> <tr><td>7</td> <td>20</td></tr> <tr><td>8</td> <td>22</td></tr> <tr><td>9</td> <td>21</td></tr> <tr><td>10</td> <td>19</td></tr> <tr><td>11</td> <td>15</td></tr> <tr><td>12</td> <td>10</td></tr></tbody></table></div> <h2 id="union"><a href="#union" aria-hidden="true" class="header-anchor">#</a> Union</h2> <p>Sometimes we just want to stack one dataset on top of the other. Well, the <code>UNION</code> operator allows us to do that.</p> <p>Suppose we have two tables and they have the same columns.</p> <p><code>table1</code>:</p> <table><thead><tr><th>pokemon</th> <th>type</th></tr></thead> <tbody><tr><td>Bulbasaur</td> <td>Grass</td></tr> <tr><td>Charmander</td> <td>Fire</td></tr> <tr><td>Squirtle</td> <td>Water</td></tr></tbody></table> <p><code>table2</code>:</p> <table><thead><tr><th>pokemon</th> <th>type</th></tr></thead> <tbody><tr><td>Snorlax</td> <td>Normal</td></tr></tbody></table> <p>If we combine these two with <code>UNION</code>:</p> <div class="language-sql line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> table1
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> table2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The result would be:</p> <table><thead><tr><th>pokemon</th> <th>type</th></tr></thead> <tbody><tr><td>Bulbasaur</td> <td>Grass</td></tr> <tr><td>Charmander</td> <td>Fire</td></tr> <tr><td>Squirtle</td> <td>Water</td></tr> <tr><td>Snorlax</td> <td>Normal</td></tr></tbody></table> <div class="warning custom-block"><p class="custom-block-title">SQL has strict rules for appending data:</p> <ul><li>Tables must have the same number of columns.</li> <li>The columns must have the same data types in the same order as the first table.</li></ul></div> <h2 id="△-with"><a href="#△-with" aria-hidden="true" class="header-anchor">#</a> △ With</h2> <p>Often times, we want to combine two tables, but one of the tables is the result of another calculation.</p> <p>Let's return to our magazine order example. Our marketing department might want to know a bit more about our customers. For instance, they might want to know how many magazines each customer subscribes to. We can easily calculate this using our <code>orders</code> table:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> customer_id<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span>subscription_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'subscriptions'</span>
<span class="token keyword">FROM</span> orders
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customer_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This query is good, but a <code>customer_id</code> isn't terribly useful for our marketing department, they probably want to know the customer's name.</p> <p>We want to be able to join the results of this query with our <code>customers</code> table, which will tell us the name of each customer. We can do this by using a <code>WITH</code> clause.</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">WITH</span> previous_results <span class="token keyword">AS</span> <span class="token punctuation">(</span>
   <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> previous_results
<span class="token keyword">JOIN</span> customers
  <span class="token keyword">ON</span> _____ <span class="token operator">=</span> _____<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>The <code>WITH</code> statement allows us to perform a separate query (such as aggregating customer's subscriptions)</li> <li><code>previous_results</code> is the alias that we will use to reference any columns from the query inside of the <code>WITH</code> clause</li> <li>We can then go on to do whatever we want with this temporary table (such as join the temporary table with another table)
Essentially, we are putting a whole first query inside the parentheses <code>()</code> and giving it a name. After that, we can use this name as if it's a table and write a new query using the first query.</li></ul> <h3 id="database-schema"><a href="#database-schema" aria-hidden="true" class="header-anchor">#</a> Database Schema</h3> <p><strong>customers</strong></p> <table><thead><tr><th>customer_id</th> <th>INT</th></tr></thead> <tbody><tr><td>customer_name</td> <td>VARCHAR(256)</td></tr> <tr><td>address</td> <td>VARCHAR(256)</td></tr></tbody></table> <p><strong>subscriptions</strong></p> <table><thead><tr><th>subscription_id</th> <th>INT</th></tr></thead> <tbody><tr><td>description</td> <td>VARCHAR(256)</td></tr> <tr><td>price_per_month</td> <td>INT</td></tr> <tr><td>subscription_length</td> <td>TEXT</td></tr></tbody></table> <p><strong>orders</strong></p> <table><thead><tr><th>order_id</th> <th>INT</th></tr></thead> <tbody><tr><td>customer_id</td> <td>INT</td></tr> <tr><td>subscription_id</td> <td>INT</td></tr> <tr><td>purchase_date</td> <td>DATE</td></tr></tbody></table> <div class="tip custom-block"><p class="custom-block-title">Mini Exercise</p> <p>Place the whole query below into a <code>WITH</code> statement, inside parentheses <code>(),</code> and give it name <code>previous_query</code>:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> customer_id<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span>subscription_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'subscriptions'</span>
<span class="token keyword">FROM</span> orders
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customer_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Join the temporary table <code>previous_query</code> with <code>customers</code> table and select the following columns:</p> <ul><li><code>customers.customer_name</code></li> <li><code>previous_query.subscriptions</code></li></ul> <p><strong>Answer</strong>
Remember to use the following <code>ON</code> statement as part of your <code>JOIN</code>:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ON</span> previous_query<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>customer_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>And for review, <code>AS</code> is how you give something an alias.</p> <p>Here, we are essentially giving everything inside the parentheses (the sub-query) the name of <code>previous_query</code> using <code>AS</code>.</p> <p>Then, <code>previous_query</code> is used as a temporary table that we will query from and also join with the <code>customers</code> table:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">WITH</span> previous_query <span class="token keyword">AS</span> <span class="token punctuation">(</span>
   <span class="token keyword">SELECT</span> customer_id<span class="token punctuation">,</span>
      <span class="token function">COUNT</span><span class="token punctuation">(</span>subscription_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'subscriptions'</span>
   <span class="token keyword">FROM</span> orders
   <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customer_id
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> customers<span class="token punctuation">.</span>customer_name<span class="token punctuation">,</span> 
   previous_query<span class="token punctuation">.</span>subscriptions
<span class="token keyword">FROM</span> previous_query
<span class="token keyword">JOIN</span> customers
  <span class="token keyword">ON</span> previous_query<span class="token punctuation">.</span>customer_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>customer_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>DO NOT</strong> include <code>;</code> inside of the <code>()</code> of your WITH statement.</p></div> <h2 id="review"><a href="#review" aria-hidden="true" class="header-anchor">#</a> Review</h2> <p>In this lesson, we learned about relationships between tables in relational databases and how to query information from multiple tables using SQL.</p> <p>Let's summarize what we've learned so far:</p> <ul><li><p><code>JOIN</code> will combine rows from different tables if the join condition is true.</p></li> <li><p><code>LEFT JOIN</code> will return every row in the <strong>left</strong> table, and if the join condition is not met, <code>NULL</code> values are used to fill in the columns from the <strong>right</strong> table.</p></li> <li><p><strong>Primary key</strong> is a column that serves a unique identifier for the rows in the table.</p></li> <li><p><strong>Foreign key</strong> is a column that contains the primary key to another table.</p></li> <li><p><code>CROSS JOIN</code> lets us combine all rows of one table with all rows of another table.</p></li> <li><p><code>UNION</code> stacks one dataset on top of another.</p></li> <li><p><code>WITH</code> allows us to define one or more temporary tables that can be used in the final query.</p></li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/sql/aggregate-functions.html" class="prev">
          Aggregate Functions
        </a></span> <span class="next"><a href="/sql/exercises.html">
          SQL Exercises
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/51.438d99df.js" defer></script><script src="/assets/js/app.157cf73c.js" defer></script>
  </body>
</html>
